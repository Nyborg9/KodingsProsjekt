@model List<WebApplication2.Data.GeoChange>

<h2>Innsendte feilmeldinger - admninistrasjon tittel</h2>

<table class="table">
    <thead>
        <tr>
            <th>ID</th>
            <th>GeoJson</th>
            <th>Beskrivelse</th>
            <th>Status</th>
            
          
        </tr>
    </thead>

    <tbody>
        <!-- foreach loop som looper gjennom alle rapportene i modellen og lager en tabellrad for hver -->
        @foreach (var report in Model)
        {
            <tr class="report-row" onclick="toggleDetails('details-@report.Id')">
                <td>@report.Id</td>
                <td>@report.GeoJson</td>
                <td>@report.Description</td>
                <td></td> <!-- Placeholder for status -->
               
             </tr>
          
            <!-- utvidbar seksjon med mer informasjon for hver rapport, basert på ID -->
            <tr id="details-@report.Id" class="report-details" style="display: none;">
                <td colspan="4">
                    <!-- 1 celle over 4 rader-->
                    <div class="details-container">

                        <!-- Map Section -->
                        <div class="map-section">
                            <h4>Kart</h4>
                            <div id="map-@report.Id" class="map-container" style="height: 200px;">
                                <p>Map showing: @report.GeoJson</p> <!-- Placeholder for map - må få inn kartvisning -->
                            </div>
                        </div>

                        <!-- User Information Section -->
                        <div class="user-info-section">
                            <h4>Mer informasjon:</h4>
                            <p><strong>Beskrivelse:</strong> @report.Description</p>
                            <p><strong>Innsender:</strong></p> <!-- innsender her-->
                            <p><strong>Kart type:</strong></p>

                        </div>

                        <!-- Caseworker Actions Section -->
                        <div class="caseworker-actions-section">
                            <h4>Rediger? feilbehandling?</h4> <!-- finne tittel -->
                            <!-- Form to update report details -->
                            <form method="post" action="/UpdateReport">
                                <input type="hidden" name="reportId" value="@report.Id" />

                                <!-- buttons for editing-->
                          
                                <label for="status-@report.Id">Status:</label>
                                <select name="status" id="status-@report.Id">
                                    <!-- Dropdown options for status - må lages  og kobles til database fungerer dårlig foreløpig.-->
                                    <option value="not_started">Ikke påbegynt</option>
                                    <option value="in_progress">Under behandling</option>
                                    <option value="approved">Godkjent</option>
                                    <option value="not_followed">Ikke tatt til følge</option>
                                </select>

                                <button type="submit">Oppdater Status</button>

                                <!-- Move the Edit and Delete links here, below the update button -->
                                <div class="edit-delete-links">
                                    <a asp-controller="ReportActions" asp-action="Edit" asp-route-id="@report.Id" asp-route-returnUrl="@Url.Action("CaseworkerOverview", "Home")">Edit</a> |
                                    <a asp-controller="ReportActions" asp-action="Delete" asp-route-id="@report.Id" asp-route-returnUrl="@Url.Action("CaseworkerOverview", "Home")">Delete</a>
                                </div>

                            </form>
                        </div>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- JavaScript function to toggle visibility of detailed report information - utvidbar seksjon -->
<script>
    function toggleDetails(detailsId) {
        var detailsRow = document.getElementById(detailsId);
        if (detailsRow.style.display === "none") {
            detailsRow.style.display = "table-row";
        } else {
            detailsRow.style.display = "none"; //skjuler raden
        }
    }
</script>

<style>
    /* Container for details section, flexbox for responsive layout */
    .details-container {
        display: flex;
        gap: 20px;
        padding: 15px;
    }
    /* Setter bredden for hver del - her til 33% så de fåt like stor del av siden */
    .map-section, .user-info-section, .caseworker-actions-section {
        width: 33%;
    }

        /* Styling for caseworker form actions - slik at dropdown menyene stackes oppå hverandre */
        .caseworker-actions-section form {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
</style>